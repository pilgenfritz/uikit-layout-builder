CKEDITOR.plugins.add("doksoft_drag_n_drop",{lang:["en"],init:function(a){if(!CKEDITOR.config.doksoft_drag_n_drop_preview_treshold){CKEDITOR.config.doksoft_drag_n_drop_preview_treshold=800;}if(!CKEDITOR.config.doksoft_drag_n_drop_embed_treshold){CKEDITOR.config.doksoft_drag_n_drop_embed_treshold=48;}if(!CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority=true;}if(typeof a.lang.doksoft_drag_n_drop.doksoft_drag_n_drop!="undefined"){a.lang.doksoft_drag_n_drop=a.lang.doksoft_drag_n_drop.doksoft_drag_n_drop;}a.on("contentDom",function(){var m=a.document.$;var l=m.createElement("link");l.href=CKEDITOR.plugins.getPath("doksoft_drag_n_drop")+"style.css";l.type="text/css";l.rel="stylesheet";m.head.appendChild(l);var j=false;var i=function(s){var w=a.document.getBody().getParent();var r=w.$.getBoundingClientRect();var v=r.left;var u=r.top;var q=v+w.$.clientWidth;var p=u+w.$.clientHeight;var t=s.data.$;if(t.clientX<=v||t.clientY<=u||t.clientX>=q||t.clientY>=p){return false;}else{return true;}};var g=function(q,u,r,t,p,v){if(Object.prototype.toString.call(q)==="[object Array]"){for(var w=0;w<q.length;w++){if(typeof(window[q[w]+"_upload_dropped_files"])==="function"){var s=window[q[w]+"_upload_dropped_files"];s(u,r,p,v);return;}}}else{if(typeof(window[q+"_upload_dropped_files"])==="function"){var s=window[q+"_upload_dropped_files"];s(u,r,p,v);return;}}alert(t);};var n=function(r,t,s){var p=window.URL||window.webkitURL;if(r[s].isImage){var q=new Image();q.onload=function(){r[s].width=q.width;r[s].height=q.height;s++;if(s==r.length){t(r);}else{n(r,t,s);}};q.src=p.createObjectURL(r[s]);}};var o=function(q,t){var p=q.length;for(var s=0;s<q.length;s++){var r=q[s].type.indexOf("image/")==0;q[s].isImage=r;if(!r){p--;}}if(p==0){t(q);}else{n(q,t,0);}};var e=function(r){var s=true;for(var t=0;t<r.length&&s;t++){if(!r[t].isImage){s=false;}}if(!s){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_file","doksoft_file"];}else{return["doksoft_file","doksoft_instant_file"];}}else{var p=true;var q=false;for(var t=0;t<r.length&&p;t++){if(r[t].width<CKEDITOR.config.doksoft_drag_n_drop_preview_treshold||r[t].height<CKEDITOR.config.doksoft_drag_n_drop_preview_treshold){p=false;}}if(!p){q=true;for(var t=0;t<r.length&&q;t++){if(r[t].width>CKEDITOR.config.doksoft_drag_n_drop_embed_treshold||r[t].height>CKEDITOR.config.doksoft_drag_n_drop_embed_treshold){allImagesAreVery=false;}}}if(p){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_preview","doksoft_preview","doksoft_instant_image","doksoft_image","doksoft_instant_file","doksoft_file","doksoft_embed"];}else{return["doksoft_preview","doksoft_instant_preview","doksoft_image","doksoft_instant_image","doksoft_file","doksoft_instant_file","doksoft_embed"];}}else{if(q){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_embed","doksoft_instant_image","doksoft_image","doksoft_instant_preview","doksoft_preview","doksoft_instant_file","doksoft_file"];}else{return["doksoft_embed","doksoft_image","doksoft_instant_image","doksoft_preview","doksoft_instant_preview","doksoft_file","doksoft_instant_file"];}}else{if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_image","doksoft_image","doksoft_instant_preview","doksoft_preview","doksoft_instant_file","doksoft_file","doksoft_embed"];}else{return["doksoft_image","doksoft_instant_image","doksoft_preview","doksoft_instant_preview","doksoft_file","doksoft_instant_file","doksoft_embed"];}}}}};var d=function(p,v,q){var y=v.document.$;if(q.rangeParent){var u=q.rangeParent,s=q.rangeOffset,x=y.createRange();x.setStart(u,s);x.collapse(true);}else{if(document.caretRangeFromPoint){x=y.caretRangeFromPoint(q.clientX,q.clientY);}else{if(h.nodeName.toLowerCase()=="img"){x=y.createRange();x.selectNode(h);}else{if(document.body.createTextRange){s=y.body.createTextRange();try{s.moveToPoint(q.clientX,q.clientY);x=s;}catch(r){x=y.createRange();x.setStartAfter(y.body.lastChild);x.collapse(true);}}}}}var t=x;var w=q.target;o(p,function(){var z;if(window["doksoft_drag_n_drop_get_handlers_list"]&&typeof(window["doksoft_drag_n_drop_get_handlers_list"])=="function"){z=window["doksoft_drag_n_drop_get_handlers_list"](p);}else{z=e(p);}g(z,p,v,v.lang.doksoft_drag_n_drop.no_handler,t,w);});};var k=function(r){var p=r.data.$.dataTransfer.items;for(var q=0;q<p.length;q++){if(p[q].kind!="file"){return false;}}return true;};var f=function(p){if(!k(p)){return;}if(a.elementMode==3){}else{if(i(p)){var q=a.document.$;q.body.parentNode.classList.add("doksoft-drag-n-drop-hover");j=true;}}};var c=function(p){if(a.elementMode==3){}else{if(!i(p)){var q=a.document.$;q.body.parentNode.classList.remove("doksoft-drag-n-drop-hover");j=false;}}};var b=function(q){if(!k(q)){return;}j=false;var p=q.data.$.dataTransfer.files;if(a.elementMode==3){}else{if(i(q)){q.data.preventDefault();var r=a.document.$;
r.body.parentNode.classList.remove("doksoft-drag-n-drop-hover");d(p,a,q.data.$);}}};var m=a.document;if(a.elementMode==3){m=a.element;}if(a.elementMode==1&&"divarea" in a.plugins){m=a.editable();}m.on("dragenter",f);m.on("dragleave",c);m.on("dragover",f);m.on("drop",b);});}});
